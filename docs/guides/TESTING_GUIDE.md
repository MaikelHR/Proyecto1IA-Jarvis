# üß™ Gu√≠a de Pruebas del Backend - Jarvis IA

Esta gu√≠a te ayudar√° a verificar que TODAS las funcionalidades del backend est√©n funcionando correctamente antes de pasar al frontend.

## üìã √çndice

1. [Prueba R√°pida (5 minutos)](#prueba-r√°pida)
2. [Prueba Completa (15 minutos)](#prueba-completa)
3. [Pruebas por M√≥dulo](#pruebas-por-m√≥dulo)
4. [Soluci√≥n de Problemas](#soluci√≥n-de-problemas)

---

## ‚ö° Prueba R√°pida (5 minutos)

### Paso 1: Verificaci√≥n Autom√°tica

```powershell
# Ejecuta el script de prueba completa
python test_complete_backend.py
```

Este script verifica:
- ‚úÖ Estructura de archivos
- ‚úÖ Modelos ML entrenados
- ‚úÖ Dependencias instaladas
- ‚úÖ Credenciales configuradas
- ‚úÖ Servicios funcionales
- ‚úÖ API importable

**Resultado esperado:**
```
üìä REPORTE FINAL
================================================
Test                                     Resultado
-------------------------------------------------------
File Structure                           ‚úì PAS√ì
ML Models                               ‚úì PAS√ì
Dependencies                            ‚úì PAS√ì
Credentials                             ‚ö†Ô∏è  OPCIONAL
Services                                ‚úì PAS√ì
API Server                              ‚úì PAS√ì

üéâ ¬°PERFECTO! TODO FUNCIONA CORRECTAMENTE
```

### Paso 2: Iniciar la API

```powershell
# Terminal 1: Inicia el servidor
python start_api.py
```

**Salida esperada:**
```
üöÄ JARVIS IA - API REST
======================================================================
‚úì Modelos cargados: 9/9
‚úì Speech-to-Text: Configurado
‚ö†Ô∏è  Face Recognition: No configurado (opcional)

INFO:     Uvicorn running on http://0.0.0.0:8000
INFO:     Application startup complete.
```

### Paso 3: Verificar Documentaci√≥n

Abre tu navegador:
- **Swagger UI**: http://localhost:8000/docs
- **Health Check**: http://localhost:8000/health

‚úÖ **Si ves la documentaci√≥n interactiva ‚Üí Backend funcionando correctamente**

---

## üî¨ Prueba Completa (15 minutos)

### Test 1: Estructura y Modelos ML

```powershell
# Verifica que los 9 modelos est√©n entrenados
python test_complete_backend.py
```

**Checklist:**
- [ ] 9 archivos `.pkl` en carpeta `reports/`
- [ ] Todos los servicios se importan sin errores
- [ ] No hay errores de m√≥dulos faltantes

**Si faltan modelos:**
```powershell
# Entrenar todos los modelos (toma ~5 minutos)
python main.py
```

---

### Test 2: API REST y Predicciones ML

```powershell
# Terminal 1: Inicia API (si no est√° corriendo)
python start_api.py

# Terminal 2: Prueba los endpoints
python -c "
import requests

# Health check
r = requests.get('http://localhost:8000/health')
print('Health:', r.json())

# Predicci√≥n de ejemplo (Telco Churn)
r = requests.post(
    'http://localhost:8000/predictions/telco_churn',
    json={
        'features': {
            'tenure': 12,
            'MonthlyCharges': 70.5,
            'TotalCharges': 846.0,
            'Contract': 'Month-to-month',
            'InternetService': 'Fiber optic'
        }
    }
)
print('Predicci√≥n:', r.json())
"
```

**Resultado esperado:**
```json
{
  "prediction": 1,
  "prediction_label": "Churn",
  "confidence": 0.85,
  "dataset": "telco_churn"
}
```

**Prueba manual en Swagger:**
1. Ve a http://localhost:8000/docs
2. Expande `POST /predictions/{dataset_key}`
3. Click en "Try it out"
4. Dataset: `telco_churn`
5. Request body:
```json
{
  "features": {
    "tenure": 12,
    "MonthlyCharges": 70.5
  }
}
```
6. Click "Execute"
7. ‚úÖ Debes ver una respuesta con predicci√≥n

---

### Test 3: Speech-to-Text

#### 3.1 Verificar Configuraci√≥n

```powershell
python setup_speech.py
```

**Salida esperada:**
```
‚úì GOOGLE_APPLICATION_CREDENTIALS: credentials\google-credentials.json
‚úì Archivo existe
‚úì Speech-to-Text Service: DISPONIBLE
‚úÖ TODO CONFIGURADO CORRECTAMENTE
```

**Si no est√° configurado:**
```powershell
# Configura la ruta a tus credenciales
$env:GOOGLE_APPLICATION_CREDENTIALS="credentials\google-credentials.json"

# Verifica nuevamente
python setup_speech.py
```

#### 3.2 Prueba con Audio

```powershell
# Prueba grabando 3 segundos de audio
python test_speech_to_text.py --duration 3
```

**Qu√© hacer:**
1. El script inicia grabaci√≥n
2. Habla claramente: "predice el precio del bitcoin"
3. Espera el resultado

**Resultado esperado:**
```
üìä RESULTADOS
==================================================
‚úì Transcripci√≥n exitosa
   Texto: "predice el precio del bitcoin"
   Confianza: 98.02%

‚úì Comando reconocido: bitcoin_price
```

#### 3.3 Prueba API de Voz

```powershell
# API debe estar corriendo
python test_voice_api.py
```

Prueba:
- Upload de audio
- Transcripci√≥n
- Reconocimiento de comandos

---

### Test 4: Face Recognition

#### 4.1 Verificar Configuraci√≥n

```powershell
python setup_face_recognition.py
```

**Si no est√° configurado (OPCIONAL):**
```powershell
# Configura credenciales de Azure
$env:AZURE_FACE_KEY="tu-key-aqu√≠"
$env:AZURE_FACE_ENDPOINT="https://tu-endpoint.cognitiveservices.azure.com/"

# Verifica
python setup_face_recognition.py
```

#### 4.2 Prueba con C√°mara

```powershell
# Requiere c√°mara disponible
python test_face_recognition.py
```

**Qu√© hace:**
1. Detecta tu c√°mara
2. Captura tu foto autom√°ticamente
3. Detecta tu rostro
4. Analiza tus emociones
5. Muestra resultados

**Resultado esperado:**
```
üìä RESULTADOS
==================================================
‚úì Emoci√≥n detectada: felicidad (87.5%)

üòä Emociones detectadas:
   felicidad       ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 87.5%
   neutral         ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 10.2%
   sorpresa        ‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë  2.3%

üéØ Emoci√≥n dominante: felicidad
   Confianza: 87.5%

üë§ Edad estimada: 25 a√±os
üë§ G√©nero: Masculino
```

#### 4.3 Prueba API de Face

```powershell
# API debe estar corriendo
python test_face_api.py
```

---

### Test 5: Prueba de Integraci√≥n Completa

```powershell
# Prueba todos los endpoints de la API
python -c "
import requests

api = 'http://localhost:8000'

# 1. Health
print('1. Health Check...')
r = requests.get(f'{api}/health')
print(f'   Status: {r.status_code} - {r.json()[\"status\"]}\n')

# 2. Predicci√≥n ML
print('2. ML Prediction...')
r = requests.post(
    f'{api}/predictions/bitcoin_price',
    json={'features': {'lag_1': 45000, 'lag_7': 44000}}
)
print(f'   Prediction: {r.json().get(\"prediction\")}\n')

# 3. Speech Status
print('3. Speech Service...')
r = requests.get(f'{api}/voice/status')
print(f'   Available: {r.json().get(\"available\")}\n')

# 4. Face Status
print('4. Face Service...')
r = requests.get(f'{api}/face/status')
print(f'   Available: {r.json().get(\"available\")}\n')

print('‚úÖ Todos los servicios respondieron correctamente')
"
```

---

## üì¶ Pruebas por M√≥dulo

### M√≥dulo 1: Machine Learning

**Datasets disponibles:**
```python
datasets = [
    "bitcoin_price",          # Regresi√≥n - Precio de Bitcoin
    "avocado_prices",         # Regresi√≥n - Precio de aguacates
    "body_fat",               # Regresi√≥n - Grasa corporal
    "car_prices",             # Regresi√≥n - Valor de autos
    "telco_churn",            # Clasificaci√≥n - Churn de clientes
    "wine_quality",           # Clasificaci√≥n - Calidad de vinos
    "stroke_risk",            # Clasificaci√≥n - Riesgo de derrame
    "hepatitis_c",            # Clasificaci√≥n - Hepatitis C
    "cirrhosis_status",       # Clasificaci√≥n - Cirrosis
]
```

**Prueba cada modelo:**
```powershell
# En PowerShell
$datasets = @(
    "bitcoin_price",
    "avocado_prices",
    "body_fat",
    "car_prices",
    "telco_churn",
    "wine_quality",
    "stroke_risk",
    "hepatitis_c",
    "cirrhosis_status"
)

foreach ($dataset in $datasets) {
    Write-Host "`nProbando $dataset..." -ForegroundColor Cyan
    
    $response = Invoke-RestMethod `
        -Uri "http://localhost:8000/predictions/$dataset" `
        -Method Post `
        -ContentType "application/json" `
        -Body '{"features": {}}'
    
    Write-Host "  ‚úì Predicci√≥n: $($response.prediction)" -ForegroundColor Green
}
```

---

### M√≥dulo 2: Speech-to-Text

**Test de audio pregrabado:**

```python
# test_speech_custom.py
import requests
import base64

# Lee un archivo de audio
with open("test_audio.wav", "rb") as f:
    audio_b64 = base64.b64encode(f.read()).decode()

# Env√≠a a la API
response = requests.post(
    "http://localhost:8000/voice/command",
    json={"audio": audio_b64}
)

print(response.json())
```

---

### M√≥dulo 3: Face Recognition

**Test con imagen:**

```python
# test_face_custom.py
import requests

# Sube una imagen
with open("test_face.jpg", "rb") as f:
    response = requests.post(
        "http://localhost:8000/face/emotion/upload",
        files={"file": f}
    )

print(response.json())
```

---

## üîß Soluci√≥n de Problemas

### Problema 1: "Module not found"

```powershell
# Reinstala dependencias
pip install -r requirements.txt
```

### Problema 2: "No module named 'api'"

```powershell
# Aseg√∫rate de estar en la carpeta del proyecto
cd D:\TEC\IA\Proyecto1IA-Jarvis

# Ejecuta desde ah√≠
python test_complete_backend.py
```

### Problema 3: "Connection refused" en API

```powershell
# Verifica que la API est√© corriendo
python start_api.py

# En otra terminal, prueba
curl http://localhost:8000/health
```

### Problema 4: Modelos no encontrados

```powershell
# Entrena todos los modelos
python main.py

# O uno espec√≠fico
python main.py --dataset telco_churn
```

### Problema 5: Speech-to-Text no funciona

```powershell
# Verifica credenciales
python setup_speech.py

# Prueba la conexi√≥n
python test_speech_to_text.py --duration 2
```

### Problema 6: Face Recognition no disponible

**Es OPCIONAL - puedes continuar sin Azure:**

```powershell
# Si quieres configurarlo:
$env:AZURE_FACE_KEY="tu-key"
$env:AZURE_FACE_ENDPOINT="tu-endpoint"

python setup_face_recognition.py
```

---

## ‚úÖ Checklist de Pruebas Completas

### Pre-requisitos
- [ ] Python 3.8+ instalado
- [ ] Dependencias instaladas (`pip install -r requirements.txt`)
- [ ] Modelos ML entrenados (9 archivos .pkl)

### Funcionalidades Core
- [ ] API inicia sin errores
- [ ] Health endpoint responde
- [ ] Documentaci√≥n Swagger accesible
- [ ] 9 modelos ML hacen predicciones

### Funcionalidades Opcionales
- [ ] Speech-to-Text configurado y funcional
- [ ] Comandos de voz reconocidos
- [ ] Face Recognition configurado (opcional)
- [ ] Detecci√≥n de emociones funcional (opcional)

### Pruebas de Integraci√≥n
- [ ] Todos los endpoints responden correctamente
- [ ] Errores manejados apropiadamente
- [ ] CORS configurado
- [ ] Logs sin errores cr√≠ticos

---

## üéØ Criterios de √âxito

### ‚úÖ M√≠nimo Aceptable (Core)
- API REST funcional
- 9 modelos ML respondiendo
- Documentaci√≥n accesible
- Health check operativo

### ‚≠ê Recomendado
- Core + Speech-to-Text funcional
- Comandos de voz reconocidos
- Audio grabable y transcribible

### üèÜ Completo
- Recomendado + Face Recognition
- Detecci√≥n de emociones
- An√°lisis facial completo
- Captura desde c√°mara

---

## üìä Matriz de Pruebas

| Componente | Comando | Tiempo | Resultado Esperado |
|------------|---------|--------|-------------------|
| Estructura | `python test_complete_backend.py` | 1 min | ‚úì Todos los archivos |
| Modelos ML | `python main.py` | 5 min | 9 modelos .pkl |
| API REST | `python start_api.py` | - | Server en :8000 |
| Swagger | Abrir browser | - | UI interactiva |
| Predicciones | Swagger ‚Üí Try it out | 1 min | JSON con predicci√≥n |
| Speech Setup | `python setup_speech.py` | 1 min | ‚úì Configurado |
| Speech Test | `python test_speech_to_text.py` | 30 seg | Transcripci√≥n exitosa |
| Voice API | `python test_voice_api.py` | 1 min | Comandos reconocidos |
| Face Setup | `python setup_face_recognition.py` | 1 min | ‚úì Configurado (opcional) |
| Face Test | `python test_face_recognition.py` | 30 seg | Emociones detectadas |
| Face API | `python test_face_api.py` | 1 min | An√°lisis exitoso |

---

## üöÄ Despu√©s de las Pruebas

### Si todo funciona ‚úÖ

**¬°Excelente! Tu backend est√° listo.**

Pr√≥ximos pasos:
1. **Documenta** lo que funciona
2. **Captura screenshots** de Swagger UI
3. **Graba un video** demostrando las funcionalidades
4. **Implementa el frontend** (ver NEXT_STEPS.md)

### Si hay problemas ‚ö†Ô∏è

1. **Revisa los logs** de errores
2. **Consulta** esta gu√≠a de soluci√≥n de problemas
3. **Verifica** dependencias y credenciales
4. **Ejecuta** `python test_complete_backend.py` para diagn√≥stico

---

## üìù Generar Reporte de Pruebas

```powershell
# Ejecuta todas las pruebas y guarda el output
python test_complete_backend.py > test_report.txt 2>&1

# Revisa el reporte
cat test_report.txt
```

---

## üìû Recursos Adicionales

- **Documentaci√≥n de la API**: http://localhost:8000/docs
- **Gu√≠a Speech-to-Text**: [SPEECH_TO_TEXT_SETUP.md](SPEECH_TO_TEXT_SETUP.md)
- **Gu√≠a Face Recognition**: [FACE_RECOGNITION_SETUP.md](FACE_RECOGNITION_SETUP.md)
- **Pr√≥ximos pasos**: [NEXT_STEPS.md](NEXT_STEPS.md)

---

**¬°Listo para probar! üß™**

Empieza con:
```powershell
python test_complete_backend.py
```
